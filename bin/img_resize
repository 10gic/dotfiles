#!/bin/bash

# Note: The file generated by GIMP is smaller than others (sips, convert, etc).
if [ ${#@} -ne 2 ]; then
    echo 'Usage: img_resize input_file width'
    exit
fi

typeset input_file=$(python3 -c "import os,sys; print(os.path.realpath(sys.argv[1]))" "$1")
typeset output_file="$input_file" # overwrite input file
typeset width=$2

# Auto compute height
typeset tmp=`sips -g pixelHeight -g pixelWidth "$input_file"`
typeset width_orig=`echo "$tmp" |grep pixelWidth|awk '{print $2}'`
typeset height_orig=`echo "$tmp" |grep pixelHeight|awk '{print $2}'`
typeset height=$(awk "BEGIN {printf \"%d\",${width} * ${height_orig} / ${width_orig}}")

/Applications/GIMP-2.10.app/Contents/MacOS/gimp -idf --batch-interpreter python-fu-eval -b "image=pdb.gimp_file_load('$input_file', '$input_file');image.scale(int('$width'),int('$height'));pdb.gimp_file_save(image, image.active_layer, '$output_file', '$output_file')" -b 'pdb.gimp_quit(1)'
# https://stackoverflow.com/questions/42888125/resize-image-by-percentage-on-both-x-and-y-on-command-line-with-gimp
